<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Storybook Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #0f172a;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 16px;
      min-height: 100vh;
      background: radial-gradient(circle at 10% 20%, #c2f0ff 0, #9de1ff 25%, #77cffc 60%, #5ab8f5 100%);
      position: relative;
      overflow-x: hidden;
    }
    .decor-bubbles { position: fixed; inset: 0; pointer-events: none; z-index: -1; }
    .decor-bubble {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0));
      border: 1px solid rgba(255,255,255,0.9);
      opacity: 0.55;
      filter: blur(0.5px);
    }
    .decor-bubble--1 { width: 140px; height: 140px; top: 6%;  left: 6%; }
    .decor-bubble--2 { width: 110px; height: 110px; top: 18%; right: 10%; }
    .decor-bubble--3 { width: 90px;  height: 90px;  bottom: 18%; left: 15%; }
    .decor-bubble--4 { width: 160px; height: 160px; bottom: -30px; right: -10px; opacity: 0.4; }
    .decor-bubble--5 { width: 70px;  height: 70px;  top: 50%; left: 55%; opacity: 0.45; }

    .container { max-width: 480px; margin: 0 auto; }
    .bubble-card {
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.95), rgba(255,255,255,0.78));
      border-radius: 32px;
      padding: 18px 16px 20px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.35), 0 0 0 1px rgba(255,255,255,0.7);
      backdrop-filter: blur(12px);
    }

    .hero { display: flex; gap: 12px; align-items: center; margin-bottom: 8px; }
    .hero-illustration {
      width: 84px; height: 84px; border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffe0f2 0, #ffb6dd 45%, #ff9fd6 80%);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 8px 18px rgba(244,114,182,0.5), 0 0 0 3px rgba(255,255,255,0.8);
      overflow: hidden;
    }
    .hero-emoji { font-size: 40px; line-height: 1; transform: translateY(2px); }
    .hero-text { flex: 1; min-width: 0; }
    h1 { font-size: 20px; margin: 0 0 4px; }
    p.description { font-size: 13px; margin: 0; color: #4b5563; }

    .lang-switch { display: flex; justify-content: flex-end; gap: 8px; margin-bottom: 10px; }
    .lang-btn {
      border-radius: 999px; border: 1px solid rgba(148,163,184,0.8);
      background: rgba(255,255,255,0.9);
      padding: 4px 12px; font-size: 11px; cursor: pointer;
      box-shadow: 0 3px 6px rgba(15,23,42,0.15);
      transition: all 0.18s ease;
      color: #000000;
    }
    .lang-btn--active {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: #000000;
      border-color: transparent;
      box-shadow: 0 4px 10px rgba(79,70,229,0.55), 0 0 0 1px rgba(255,255,255,0.8) inset;
    }

    form { margin-top: 10px; }
    .field {
      margin-bottom: 12px;
      padding: 8px 10px 10px;
      border-radius: 18px;
      background: radial-gradient(circle at 15% 10%, rgba(255,255,255,0.98), rgba(255,255,255,0.78));
      box-shadow: 0 6px 12px rgba(15,23,42,0.12), 0 0 0 1px rgba(255,255,255,0.85);
    }
    label { display: block; font-size: 12px; margin-bottom: 4px; color: #334155; }
    .field-hint { display: block; margin-top: 6px; font-size: 11px; color: #6b7280; }

    input, select, textarea {
      width: 100%;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      font-size: 13px;
      outline: none;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 2px 4px rgba(15,23,42,0.05) inset;
    }
    textarea { border-radius: 18px; resize: vertical; min-height: 60px; }
    input::placeholder, textarea::placeholder { color: #9ca3af; }
    input:focus, select:focus, textarea:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(129,140,248,0.6), 0 0 0 4px rgba(129,140,248,0.26);
      background: #ffffff;
    }

    .hidden { display: none !important; }

    .choice-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 6px;
    }
    .choice-card {
      position: relative;
      border-radius: 18px;
      padding: 10px 12px;
      border: 1px solid rgba(148,163,184,0.65);
      background: rgba(255,255,255,0.85);
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(15,23,42,0.08);
      transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
      display: flex;
      gap: 10px;
      align-items: flex-start;
      user-select: none;
      min-height: 54px;
    }
    .choice-card:active { transform: translateY(1px); }
    .choice-card--selected {
      border-color: rgba(99,102,241,0.9);
      box-shadow: 0 6px 14px rgba(79,70,229,0.20), 0 0 0 1px rgba(255,255,255,0.75) inset;
      background: rgba(255,255,255,0.92);
    }
    .choice-card input { position: absolute; opacity: 0; pointer-events: none; }
    .choice-icon { font-size: 18px; line-height: 1; margin-top: 1px; }
    .choice-title { font-size: 12px; font-weight: 700; color: #0f172a; margin: 0; }
    .choice-subtitle { font-size: 11px; color: #64748b; margin: 2px 0 0; }

    .subgrid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 8px; }
    .subgrid-1 { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 8px; }
    .divider {
      height: 1px;
      background: rgba(148,163,184,0.45);
      margin: 10px 0;
    }
    .section-title {
      font-size: 12px;
      font-weight: 800;
      color: #0f172a;
      margin: 2px 0 6px;
    }

    button {
      width: 100%;
      padding: 11px 16px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: radial-gradient(circle at 20% 0, #a5b4fc, #6366f1);
      color: #ffffff;
      box-shadow: 0 10px 20px rgba(79,70,229,0.55), 0 0 0 1px rgba(255,255,255,0.9) inset;
      margin-top: 4px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }
    button:active {
      transform: translateY(1px);
      box-shadow: 0 6px 14px rgba(79,70,229,0.55), 0 0 0 1px rgba(255,255,255,0.9) inset;
      filter: brightness(0.98);
    }
    button:disabled {
      opacity: 0.7;
      cursor: default;
      box-shadow: 0 4px 8px rgba(148,163,184,0.5), 0 0 0 1px rgba(255,255,255,0.9) inset;
    }

    .note { font-size: 11px; color: #475569; margin-top: 8px; text-align: center; }
  </style>
</head>
<body>
  <div class="decor-bubbles">
    <span class="decor-bubble decor-bubble--1"></span>
    <span class="decor-bubble decor-bubble--2"></span>
    <span class="decor-bubble decor-bubble--3"></span>
    <span class="decor-bubble decor-bubble--4"></span>
    <span class="decor-bubble decor-bubble--5"></span>
  </div>

  <main class="container">
    <div class="bubble-card">
      <div class="lang-switch">
        <button type="button" class="lang-btn lang-btn--active" data-lang="ru">RU</button>
        <button type="button" class="lang-btn" data-lang="en">EN</button>
      </div>

      <div class="hero">
        <div class="hero-illustration"><span class="hero-emoji">üìñ</span></div>
        <div class="hero-text">
          <h1 id="title">–°–æ–∑–¥–∞—Ç—å —Å–∫–∞–∑–∫—É</h1>
          <p class="description" id="description">
            –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –±–æ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å–∫–∞–∑–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –µ—ë –≤ —á–∞—Ç –≤ –≤–∏–¥–µ PDF-–∫–Ω–∏–≥–∏.
          </p>
        </div>
      </div>

      <form id="storyForm">
        <!-- 1) –ò–º—è –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è -->
        <div class="field">
          <label for="child_name" id="label_child_name">–ò–º—è –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è *</label>
          <input id="child_name" name="child_name" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ê—Ä–∏–Ω–∞" />
        </div>

        <!-- 1) –í–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è -->
        <div class="field">
          <label id="label_main_personalization">–ü–µ—Ä—Å–æ–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è *</label>

          <div class="choice-grid" id="main_personalization_group">
            <div class="choice-card choice-card--selected" data-group="main_personalization" data-value="photo">
              <input type="radio" name="main_personalization_mode" value="photo" checked />
              <div class="choice-icon">üì∑</div>
              <div>
                <p class="choice-title">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</p>
                <p class="choice-subtitle">–§–æ—Ç–æ –ø–æ–ø—Ä–æ—Å–∏—Ç –±–æ—Ç –≤ —á–∞—Ç–µ</p>
              </div>
            </div>

            <div class="choice-card" data-group="main_personalization" data-value="appearance">
              <input type="radio" name="main_personalization_mode" value="appearance" />
              <div class="choice-icon">üß©</div>
              <div>
                <p class="choice-title">–í—ã–±—Ä–∞—Ç—å –≤–Ω–µ—à–Ω–æ—Å—Ç—å</p>
                <p class="choice-subtitle">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —É–∑–Ω–∞–≤–∞–µ–º–æ—Å—Ç—å –±–µ–∑ —Ñ–æ—Ç–æ</p>
              </div>
            </div>

            <div class="choice-card" data-group="main_personalization" data-value="none" style="grid-column: 1 / span 2;">
              <input type="radio" name="main_personalization_mode" value="none" />
              <div class="choice-icon">‚ú®</div>
              <div>
                <p class="choice-title">–ë–µ–∑ –ø–µ—Ä—Å–æ–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏</p>
                <p class="choice-subtitle">–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≥–µ—Ä–æ–π</p>
              </div>
            </div>
          </div>

          <small class="field-hint" id="hint_main_personalization">
            –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–æ—Ç–æ –±–æ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç –µ–≥–æ —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –ø–æ—Å–ª–µ —Ñ–æ—Ä–º—ã.
          </small>
        </div>

        <!-- 1.2) –ü–æ–ª—è –≤–Ω–µ—à–Ω–æ—Å—Ç–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è (–ø–æ—è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ "appearance") -->
        <div class="field hidden" id="mainAppearanceBlock">
          <div class="section-title">–í–Ω–µ—à–Ω–æ—Å—Ç—å –≥–ª–∞–≤–Ω–æ–≥–æ –≥–µ—Ä–æ—è</div>

          <div class="subgrid">
            <div>
              <label for="main_gender">–ü–æ–ª —Ä–µ–±—ë–Ω–∫–∞ *</label>
              <select id="main_gender" name="main_gender">
                <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                <option value="girl">–î–µ–≤–æ—á–∫–∞</option>
                <option value="boy">–ú–∞–ª—å—á–∏–∫</option>
                <option value="unspecified">–ù–µ–≤–∞–∂–Ω–æ</option>
              </select>
            </div>

            <div>
              <label for="main_skin_tone">–¢–æ–Ω –∫–æ–∂–∏ *</label>
              <select id="main_skin_tone" name="main_skin_tone">
                <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                <option value="very_light">–û—á–µ–Ω—å —Å–≤–µ—Ç–ª—ã–π</option>
                <option value="light">–°–≤–µ—Ç–ª—ã–π</option>
                <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                <option value="tan">–°–º—É–≥–ª—ã–π</option>
                <option value="dark">–¢—ë–º–Ω—ã–π</option>
              </select>
            </div>
          </div>

          <div class="divider"></div>
          <div class="section-title">–í–æ–ª–æ—Å—ã</div>

          <div class="subgrid">
            <div>
              <label for="main_hair_color">–¶–≤–µ—Ç *</label>
              <select id="main_hair_color" name="main_hair_color">
                <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                <option value="blonde">–ë–ª–æ–Ω–¥</option>
                <option value="light_brown">–†—É—Å—ã–π/—Å–≤–µ—Ç–ª–æ-–∫–∞—à—Ç–∞–Ω–æ–≤—ã–π</option>
                <option value="brown">–ö–∞—à—Ç–∞–Ω–æ–≤—ã–π</option>
                <option value="dark_brown">–¢—ë–º–Ω–æ-–∫–∞—à—Ç–∞–Ω–æ–≤—ã–π</option>
                <option value="black">–ß—ë—Ä–Ω—ã–π</option>
                <option value="red">–†—ã–∂–∏–π</option>
                <option value="other">–î—Ä—É–≥–æ–µ</option>
              </select>
            </div>

            <div>
              <label for="main_hair_length">–î–ª–∏–Ω–∞ *</label>
              <select id="main_hair_length" name="main_hair_length">
                <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                <option value="very_short">–û—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–µ</option>
                <option value="short">–ö–æ—Ä–æ—Ç–∫–∏–µ</option>
                <option value="shoulder">–î–æ –ø–ª–µ—á</option>
                <option value="long">–î–ª–∏–Ω–Ω—ã–µ</option>
              </select>
            </div>
          </div>

          <div class="subgrid">
            <div>
              <label for="main_hair_type">–¢–∏–ø</label>
              <select id="main_hair_type" name="main_hair_type">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="straight">–ü—Ä—è–º—ã–µ</option>
                <option value="wavy">–í–æ–ª–Ω–∏—Å—Ç—ã–µ</option>
                <option value="curly">–ö—É–¥—Ä—è–≤—ã–µ</option>
              </select>
            </div>

            <div>
              <label for="main_hair_density">–ì—É—Å—Ç–æ—Ç–∞</label>
              <select id="main_hair_density" name="main_hair_density">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="thin">–†–µ–¥–∫–∏–µ</option>
                <option value="medium">–°—Ä–µ–¥–Ω–∏–µ</option>
                <option value="thick">–ì—É—Å—Ç—ã–µ</option>
              </select>
            </div>
          </div>

          <div class="subgrid">
            <div>
              <label for="main_hair_bangs">–ß—ë–ª–∫–∞</label>
              <select id="main_hair_bangs" name="main_hair_bangs">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="yes">–î–∞</option>
                <option value="no">–ù–µ—Ç</option>
              </select>
            </div>

            <div>
              <label for="main_hair_part">–ü—Ä–æ–±–æ—Ä</label>
              <select id="main_hair_part" name="main_hair_part">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="left">–°–ª–µ–≤–∞</option>
                <option value="right">–°–ø—Ä–∞–≤–∞</option>
                <option value="center">–ü–æ —Ü–µ–Ω—Ç—Ä—É</option>
              </select>
            </div>
          </div>

          <div class="divider"></div>
          <div class="section-title">–ì–ª–∞–∑–∞ –∏ –ª–∏—Ü–æ</div>

          <div class="subgrid">
            <div>
              <label for="main_eye_color">–¶–≤–µ—Ç –≥–ª–∞–∑ *</label>
              <select id="main_eye_color" name="main_eye_color">
                <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                <option value="blue">–ì–æ–ª—É–±—ã–µ/—Å–∏–Ω–∏–µ</option>
                <option value="green">–ó–µ–ª—ë–Ω—ã–µ</option>
                <option value="brown">–ö–∞—Ä–∏–µ</option>
                <option value="gray">–°–µ—Ä—ã–µ</option>
                <option value="hazel">–û—Ä–µ—Ö–æ–≤—ã–µ</option>
                <option value="other">–î—Ä—É–≥–æ–µ</option>
              </select>
            </div>

            <div>
              <label for="main_eye_shape">–§–æ—Ä–º–∞</label>
              <select id="main_eye_shape" name="main_eye_shape">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="round">–ö—Ä—É–≥–ª—ã–µ</option>
                <option value="almond">–ú–∏–Ω–¥–∞–ª–µ–≤–∏–¥–Ω—ã–µ</option>
              </select>
            </div>
          </div>

          <div class="subgrid">
            <div>
              <label for="main_eye_size">–†–∞–∑–º–µ—Ä</label>
              <select id="main_eye_size" name="main_eye_size">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="small">–ù–µ–±–æ–ª—å—à–∏–µ</option>
                <option value="medium">–°—Ä–µ–¥–Ω–∏–µ</option>
                <option value="large">–ö—Ä—É–ø–Ω—ã–µ</option>
              </select>
            </div>

            <div>
              <label for="main_face_shape">–§–æ—Ä–º–∞ –ª–∏—Ü–∞ *</label>
              <select id="main_face_shape" name="main_face_shape">
                <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                <option value="round">–ö—Ä—É–≥–ª–æ–µ</option>
                <option value="oval">–û–≤–∞–ª—å–Ω–æ–µ</option>
                <option value="long">–£–¥–ª–∏–Ω—ë–Ω–Ω–æ–µ</option>
              </select>
            </div>
          </div>

          <div class="subgrid-1">
            <div>
              <label for="main_face_accent">–î–æ–ø. –∞–∫—Ü–µ–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
              <input id="main_face_accent" name="main_face_accent" placeholder="–ù–∞–ø—Ä.: –ø—É—Ö–ª—ã–µ —â—ë–∫–∏, –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–π –ø–æ–¥–±–æ—Ä–æ–¥–æ–∫" />
            </div>
          </div>

          <div class="divider"></div>
          <div class="section-title">–ë—Ä–æ–≤–∏, –Ω–æ—Å, –≥—É–±—ã</div>

          <div class="subgrid">
            <div>
              <label for="main_eyebrows_color">–ë—Ä–æ–≤–∏: —Ü–≤–µ—Ç</label>
              <select id="main_eyebrows_color" name="main_eyebrows_color">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="light">–°–≤–µ—Ç–ª—ã–µ</option>
                <option value="dark">–¢—ë–º–Ω—ã–µ</option>
              </select>
            </div>

            <div>
              <label for="main_eyebrows_density">–ë—Ä–æ–≤–∏: –≥—É—Å—Ç–æ—Ç–∞</label>
              <select id="main_eyebrows_density" name="main_eyebrows_density">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="thin">–¢–æ–Ω–∫–∏–µ</option>
                <option value="medium">–°—Ä–µ–¥–Ω–∏–µ</option>
                <option value="thick">–ì—É—Å—Ç—ã–µ</option>
              </select>
            </div>
          </div>

          <div class="subgrid">
            <div>
              <label for="main_eyebrows_shape">–ë—Ä–æ–≤–∏: —Ñ–æ—Ä–º–∞</label>
              <select id="main_eyebrows_shape" name="main_eyebrows_shape">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="straight">–ü—Ä—è–º—ã–µ</option>
                <option value="arched">–î—É–≥–æ–π</option>
              </select>
            </div>

            <div>
              <label for="main_nose_size">–ù–æ—Å (–ø–æ –∂–µ–ª–∞–Ω–∏—é)</label>
              <select id="main_nose_size" name="main_nose_size">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="small">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
                <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                <option value="pronounced">–í—ã—Ä–∞–∂–µ–Ω–Ω—ã–π</option>
              </select>
            </div>
          </div>

          <div class="subgrid">
            <div>
              <label for="main_lips_type">–ì—É–±—ã (–ø–æ –∂–µ–ª–∞–Ω–∏—é)</label>
              <select id="main_lips_type" name="main_lips_type">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="thin">–¢–æ–Ω–∫–∏–µ</option>
                <option value="medium">–°—Ä–µ–¥–Ω–∏–µ</option>
                <option value="full">–ü—É—Ö–ª—ã–µ</option>
              </select>
            </div>

            <div>
              <label for="main_technical_features">–¢–µ—Ö. –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ (–æ–ø—Ü.)</label>
              <input id="main_technical_features" name="main_technical_features" placeholder="–ù–∞–ø—Ä.: –æ—á–∫–∏, —Å–ª—É—Ö–æ–≤–æ–π –∞–ø–ø–∞—Ä–∞—Ç" />
            </div>
          </div>

          <div class="divider"></div>
          <div class="section-title">–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –º–µ—Ç–∫–∏ (1‚Äì2 –ø—Ä–∏–∑–Ω–∞–∫–∞)</div>

          <div class="subgrid-1">
            <div>
              <label for="main_unique_marks">–í—ã–±–µ—Ä–∏—Ç–µ 1‚Äì2 *</label>
              <select id="main_unique_marks" name="main_unique_marks" multiple size="6" style="border-radius: 18px; padding: 10px 12px;">
                <option value="freckles">–í–µ—Å–Ω—É—à–∫–∏</option>
                <option value="dimples">–Ø–º–æ—á–∫–∏</option>
                <option value="mole_forehead">–†–æ–¥–∏–Ω–∫–∞ (–ª–æ–±)</option>
                <option value="mole_cheek">–†–æ–¥–∏–Ω–∫–∞ (—â—ë–∫–∞)</option>
                <option value="mole_nose">–†–æ–¥–∏–Ω–∫–∞ (–Ω–æ—Å)</option>
                <option value="mole_chin">–†–æ–¥–∏–Ω–∫–∞ (–ø–æ–¥–±–æ—Ä–æ–¥–æ–∫)</option>
                <option value="signature_smile">–•–∞—Ä–∞–∫—Ç–µ—Ä–Ω–∞—è —É–ª—ã–±–∫–∞</option>
                <option value="notable_curls">–ó–∞–º–µ—Ç–Ω—ã–µ –∫—É–¥—Ä—è—à–∫–∏</option>
                <option value="special_hairstyle">–û—Å–æ–±–∞—è –ø—Ä–∏—á—ë—Å–∫–∞/–∑–∞–∫–æ–ª–∫–∞</option>
                <option value="glasses">–û—á–∫–∏ (—Ñ–æ—Ä–º–∞ –≤–∞–∂–Ω–∞)</option>
                <option value="other">–î—Ä—É–≥–æ–µ (–∫–æ—Ä–æ—Ç–∫–æ)</option>
              </select>
              <small class="field-hint">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –º–∞–∫—Å–∏–º—É–º 2 –ø—É–Ω–∫—Ç–∞. –ï—Å–ª–∏ –≤—ã–±—Ä–∞–ª–∏ ¬´–î—Ä—É–≥–æ–µ¬ª, —É–∫–∞–∂–∏—Ç–µ –Ω–∏–∂–µ.</small>
            </div>

            <div>
              <label for="main_unique_marks_other">–î—Ä—É–≥–æ–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
              <input id="main_unique_marks_other" name="main_unique_marks_other" placeholder="1 –∫–æ—Ä–æ—Ç–∫–∞—è —Ñ—Ä–∞–∑–∞" />
            </div>
          </div>

          <div class="divider"></div>
          <div class="section-title">–û–±—Ä–∞–∑ (—è–∫–æ—Ä—å —É–∑–Ω–∞–≤–∞–µ–º–æ—Å—Ç–∏ –±–µ–∑ —Ñ–æ—Ç–æ)</div>

          <div class="subgrid">
            <div>
              <label for="main_outfit">–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –æ–¥–µ–∂–¥–∞ *</label>
              <input id="main_outfit" name="main_outfit" placeholder="–ù–∞–ø—Ä.: —Ö—É–¥–∏ + –¥–∂–∏–Ω—Å—ã / –ø–ª–∞—Ç—å–µ" />
            </div>

            <div>
              <label for="main_shoes">–û–±—É–≤—å</label>
              <input id="main_shoes" name="main_shoes" placeholder="–ö–µ–¥—ã, –±–æ—Ç–∏–Ω–∫–∏, —Å–∞–Ω–¥–∞–ª–∏–∏‚Ä¶" />
            </div>
          </div>

          <div class="subgrid">
            <div>
              <label for="main_accessory">1 –∞–∫—Å–µ—Å—Å—É–∞—Ä</label>
              <input id="main_accessory" name="main_accessory" placeholder="–†—é–∫–∑–∞—á–æ–∫, –æ–±–æ–¥–æ–∫, –∏–≥—Ä—É—à–∫–∞‚Ä¶" />
            </div>

            <div>
              <label for="main_palette">–ü–∞–ª–∏—Ç—Ä–∞ 2‚Äì3 —Ü–≤–µ—Ç–∞ *</label>
              <input id="main_palette" name="main_palette" placeholder="–ù–∞–ø—Ä.: –∫—Ä–∞—Å–Ω—ã–π + —Å–∏–Ω–∏–π + –±–µ–ª—ã–π" />
            </div>
          </div>
        </div>

        <!-- 2) –í—Ç–æ—Ä–æ–π –≥–µ—Ä–æ–π -->
        <div class="field">
          <label id="label_second_character">–í—Ç–æ—Ä–æ–π –≥–µ—Ä–æ–π *</label>

          <div class="choice-grid" id="second_character_group">
            <div class="choice-card choice-card--selected" data-group="second_character" data-value="none">
              <input type="radio" name="second_character_mode" value="none" checked />
              <div class="choice-icon">‚ûñ</div>
              <div>
                <p class="choice-title">–ë–µ–∑ –≤—Ç–æ—Ä–æ–≥–æ –≥–µ—Ä–æ—è</p>
                <p class="choice-subtitle">–°–∫–∞–∑–∫–∞ —Å –æ–¥–Ω–∏–º –≥–µ—Ä–æ–µ–º</p>
              </div>
            </div>

            <div class="choice-card" data-group="second_character" data-value="preset">
              <input type="radio" name="second_character_mode" value="preset" />
              <div class="choice-icon">ü¶ä</div>
              <div>
                <p class="choice-title">–í—ã–±—Ä–∞—Ç—å –∏–∑ 6</p>
                <p class="choice-subtitle">–ì–æ—Ç–æ–≤—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏</p>
              </div>
            </div>

            <div class="choice-card" data-group="second_character" data-value="custom" style="grid-column: 1 / span 2;">
              <input type="radio" name="second_character_mode" value="custom" />
              <div class="choice-icon">üõ†Ô∏è</div>
              <div>
                <p class="choice-title">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä</p>
                <p class="choice-subtitle">–û–ø–∏—à–∏—Ç–µ —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</p>
              </div>
            </div>
          </div>

          <small class="field-hint" id="hint_second_character">
            –ï—Å–ª–∏ –≤—ã–±–µ—Ä–µ—Ç–µ ¬´–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π¬ª, –ø–æ—è–≤—è—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã.
          </small>
        </div>

        <div class="field hidden" id="secondPresetBlock">
          <label for="second_character_preset">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ *</label>
          <select id="second_character_preset" name="second_character_preset">
            <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
            <option value="foxik">–õ–∏—Å—ë–Ω–æ–∫ –§–æ–∫—Å–∏–∫</option>
            <option value="tihonya">–°–æ–≤–∞ –¢–∏—Ö–æ–Ω—è</option>
            <option value="bublik">–©–µ–Ω–æ–∫ –ë—É–±–ª–∏–∫</option>
            <option value="pixel">–†–æ–±–æ—Ç –ü–∏–∫—Å–µ–ª—å</option>
            <option value="iskrik">–î—Ä–∞–∫–æ–Ω—á–∏–∫ –ò—Å–∫—Ä–∏–∫</option>
            <option value="puzyrek">–ú–æ—Ä—Å–∫–æ–π –∫–æ–Ω—ë–∫ –ü—É–∑—ã—Ä—ë–∫</option>
          </select>
          <small class="field-hint">–í —á–∞—Ç–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –≤—Ç–æ—Ä–æ–≥–æ –≥–µ—Ä–æ—è –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è).</small>
        </div>

        <div class="field hidden" id="secondCustomBlock">
          <div class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ç–æ—Ä–æ–≥–æ –≥–µ—Ä–æ—è</div>

          <div class="subgrid">
            <div>
              <label for="second_custom_name">–ò–º—è/–Ω–∞–∑–≤–∞–Ω–∏–µ *</label>
              <input id="second_custom_name" name="second_custom_name" placeholder="–ù–∞–ø—Ä.: –ö–æ—Ç –¢—É–º–∞–Ω, –†–æ–±–æ—Ç –ù–∞–Ω–æ‚Ä¶" />
            </div>

            <div>
              <label for="second_custom_type">–ö—Ç–æ —ç—Ç–æ? *</label>
              <select id="second_custom_type" name="second_custom_type">
                <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                <option value="human">–ß–µ–ª–æ–≤–µ–∫</option>
                <option value="animal">–ñ–∏–≤–æ—Ç–Ω–æ–µ</option>
                <option value="robot">–†–æ–±–æ—Ç</option>
                <option value="mythical">–í–æ–ª—à–µ–±–Ω–æ–µ —Å—É—â–µ—Å—Ç–≤–æ</option>
                <option value="toy">–ò–≥—Ä—É—à–∫–∞</option>
                <option value="other">–î—Ä—É–≥–æ–µ</option>
              </select>
            </div>
          </div>

          <div class="subgrid-1">
            <div>
              <label for="second_custom_appearance">–í–Ω–µ—à–Ω–æ—Å—Ç—å (2‚Äì3 –ø—Ä–∏–∑–Ω–∞–∫–∞)</label>
              <input id="second_custom_appearance" name="second_custom_appearance" placeholder="–ù–∞–ø—Ä.: –ø—É—à–∏—Å—Ç—ã–π, —Å–µ—Ä—ã–π, —Å –±–µ–ª—ã–º–∏ –ª–∞–ø–∫–∞–º–∏" />
            </div>
            <div>
              <label for="second_custom_marks">–û—Ç–ª–∏—á–∏—Ç–µ–ª—å–Ω–∞—è ¬´–º–µ—Ç–∫–∞¬ª (1‚Äì2)</label>
              <input id="second_custom_marks" name="second_custom_marks" placeholder="–ù–∞–ø—Ä.: –æ—á–∫–∏-–∫–∞–ø–ª–∏, –∑–≤—ë–∑–¥–æ—á–∫–∞ –Ω–∞ –ª–±—É" />
            </div>
            <div>
              <label for="second_custom_traits">–•–∞—Ä–∞–∫—Ç–µ—Ä (2‚Äì3 —Å–ª–æ–≤–∞) *</label>
              <input id="second_custom_traits" name="second_custom_traits" placeholder="–ù–∞–ø—Ä.: —Å–º–µ–ª—ã–π, –¥–æ–±—Ä—ã–π, –ª—é–±–æ–ø—ã—Ç–Ω—ã–π" />
            </div>
          </div>
        </div>

        <!-- 3) –ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="field">
          <label id="label_setting_mode">–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è *</label>

          <div class="choice-grid" id="setting_group">
            <div class="choice-card choice-card--selected" data-group="setting" data-value="forest">
              <input type="radio" name="setting_mode" value="forest" checked />
              <div class="choice-icon">üå≤</div>
              <div><p class="choice-title">–í–æ–ª—à–µ–±–Ω—ã–π –ª–µ—Å</p><p class="choice-subtitle">–¢—Ä–æ–ø–∏–Ω–∫–∏, –ø–æ–ª—è–Ω—ã</p></div>
            </div>

            <div class="choice-card" data-group="setting" data-value="sea">
              <input type="radio" name="setting_mode" value="sea" />
              <div class="choice-icon">üåä</div>
              <div><p class="choice-title">–ú–æ—Ä–µ –∏ –±–µ—Ä–µ–≥</p><p class="choice-subtitle">–ü–µ—Å–æ–∫, –≤–æ–ª–Ω—ã</p></div>
            </div>

            <div class="choice-card" data-group="setting" data-value="city">
              <input type="radio" name="setting_mode" value="city" />
              <div class="choice-icon">üèôÔ∏è</div>
              <div><p class="choice-title">–ì–æ—Ä–æ–¥</p><p class="choice-subtitle">–£–ª–∏—Ü—ã, –≤–∏—Ç—Ä–∏–Ω—ã</p></div>
            </div>

            <div class="choice-card" data-group="setting" data-value="mountains">
              <input type="radio" name="setting_mode" value="mountains" />
              <div class="choice-icon">‚õ∞Ô∏è</div>
              <div><p class="choice-title">–ì–æ—Ä—ã</p><p class="choice-subtitle">–¢—Ä–æ–ø—ã, –≤–µ—Ä—à–∏–Ω—ã</p></div>
            </div>

            <div class="choice-card" data-group="setting" data-value="space">
              <input type="radio" name="setting_mode" value="space" />
              <div class="choice-icon">üöÄ</div>
              <div><p class="choice-title">–ö–æ—Å–º–æ—Å</p><p class="choice-subtitle">–°—Ç–∞–Ω—Ü–∏—è, –ø–ª–∞–Ω–µ—Ç—ã</p></div>
            </div>

            <div class="choice-card" data-group="setting" data-value="home">
              <input type="radio" name="setting_mode" value="home" />
              <div class="choice-icon">üè°</div>
              <div><p class="choice-title">–î–æ–º –∏ –¥–≤–æ—Ä</p><p class="choice-subtitle">–£—é—Ç, –∑–Ω–∞–∫–æ–º–æ—Å—Ç—å</p></div>
            </div>

            <div class="choice-card" data-group="setting" data-value="custom" style="grid-column: 1 / span 2;">
              <input type="radio" name="setting_mode" value="custom" />
              <div class="choice-icon">üß≠</div>
              <div><p class="choice-title">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ</p><p class="choice-subtitle">–¢–∏–ø + —Å–µ–∑–æ–Ω + –¥–µ—Ç–∞–ª–∏</p></div>
            </div>
          </div>

          <small class="field-hint">–ï—Å–ª–∏ –≤—ã–±–µ—Ä–µ—Ç–µ ¬´–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ¬ª, –ø–æ—è–≤–∏—Ç—Å—è –±–ª–æ–∫ —É—Ç–æ—á–Ω–µ–Ω–∏–π.</small>
        </div>

        <div class="field hidden" id="settingCustomBlock">
          <div class="section-title">–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ</div>

          <div class="subgrid">
            <div>
              <label for="setting_type">–¢–∏–ø –º–µ—Å—Ç–∞ *</label>
              <select id="setting_type" name="setting_type">
                <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                <option value="forest">–õ–µ—Å/–ø–∞—Ä–∫</option>
                <option value="city">–ì–æ—Ä–æ–¥</option>
                <option value="sea">–ú–æ—Ä–µ/—Ä–µ–∫–∞</option>
                <option value="mountains">–ì–æ—Ä—ã</option>
                <option value="space">–ö–æ—Å–º–æ—Å</option>
                <option value="home">–î–æ–º/—Å–∞–¥</option>
                <option value="other">–î—Ä—É–≥–æ–µ</option>
              </select>
            </div>

            <div>
              <label for="setting_realism">–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å *</label>
              <select id="setting_realism" name="setting_realism">
                <option value="" selected disabled>–í—ã–±–µ—Ä–∏—Ç–µ</option>
                <option value="realistic">–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ</option>
                <option value="fairy">–°–∫–∞–∑–æ—á–Ω–æ</option>
                <option value="mixed">–°–º–µ—à–∞–Ω–Ω–æ–µ</option>
              </select>
            </div>
          </div>

          <div class="subgrid">
            <div>
              <label for="setting_time">–í—Ä–µ–º—è —Å—É—Ç–æ–∫</label>
              <select id="setting_time" name="setting_time">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="morning">–£—Ç—Ä–æ</option>
                <option value="day">–î–µ–Ω—å</option>
                <option value="evening">–í–µ—á–µ—Ä</option>
                <option value="night">–ù–æ—á—å</option>
              </select>
            </div>

            <div>
              <label for="setting_season">–°–µ–∑–æ–Ω</label>
              <select id="setting_season" name="setting_season">
                <option value="" selected>–ù–µ–≤–∞–∂–Ω–æ</option>
                <option value="spring">–í–µ—Å–Ω–∞</option>
                <option value="summer">–õ–µ—Ç–æ</option>
                <option value="autumn">–û—Å–µ–Ω—å</option>
                <option value="winter">–ó–∏–º–∞</option>
              </select>
            </div>
          </div>

          <div class="subgrid-1">
            <div>
              <label for="setting_point">–¢–æ—á–∫–∞/–æ—Ä–∏–µ–Ω—Ç–∏—Ä (–æ–ø—Ü.)</label>
              <input id="setting_point" name="setting_point" placeholder="–ù–∞–ø—Ä.: —É –º–∞—è–∫–∞, –Ω–∞ –ø–ª–æ—â–∞–¥–∏, —É —Å—Ç–∞—Ä–æ–≥–æ –¥—É–±–∞" />
            </div>

            <div>
              <label for="setting_details">3 –¥–µ—Ç–∞–ª–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) *</label>
              <input id="setting_details" name="setting_details" placeholder="–ù–∞–ø—Ä.: —Ñ–æ–Ω–∞—Ä–∏, –º–æ—Å—Ç–∏–∫, –∑–∞–ø–∞—Ö –≤—ã–ø–µ—á–∫–∏" />
            </div>
          </div>
        </div>

        <!-- 4) –í–æ–∑—Ä–∞—Å—Ç -->
        <div class="field">
          <label for="age_group" id="label_age_group">–í–æ–∑—Ä–∞—Å—Ç —Ä–µ–±—ë–Ω–∫–∞ *</label>
          <select id="age_group" name="age_group" required>
            <option value="age_0_3">0‚Äì3 –≥–æ–¥–∞</option>
            <option value="age_4_6" selected>4‚Äì6 –ª–µ—Ç</option>
            <option value="age_7_12">7‚Äì12 –ª–µ—Ç</option>
            <option value="age_12_16">12‚Äì16 –ª–µ—Ç</option>
            <option value="age_16_plus">–°—Ç–∞—Ä—à–µ 16</option>
          </select>
        </div>

        <!-- 5) –°—Ç–∏–ª—å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è -->
        <div class="field">
          <label for="narrative_style" id="label_narrative_style">–°—Ç–∏–ª—å –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è *</label>
          <select id="narrative_style" name="narrative_style" required>
            <option value="gentle_meditative">–°–ø–æ–∫–æ–π–Ω—ã–π –º–µ–¥–∏—Ç–∞—Ç–∏–≤–Ω—ã–π</option>
            <option value="adventurous">–ü—Ä–∏–∫–ª—é—á–µ–Ω—á–µ—Å–∫–∏–π</option>
            <option value="mysterious">–ó–∞–≥–∞–¥–æ—á–Ω—ã–π</option>
            <option value="humorous">–° —é–º–æ—Ä–æ–º</option>
            <option value="lyrical">–õ–∏—Ä–∏—á–µ—Å–∫–∏–π</option>
          </select>
        </div>

        <!-- 6) –ü–æ—É—á–∏—Ç–µ–ª—å–Ω—ã–π —Å—é–∂–µ—Ç -->
        <div class="field">
          <label for="educational_plot" id="label_educational_plot">–ü–æ—É—á–∏—Ç–µ–ª—å–Ω—ã–π —Å—é–∂–µ—Ç *</label>
          <select id="educational_plot" name="educational_plot" required>
            <option value="kindness_help">–î–æ–±—Ä–æ—Ç–∞ –∏ –ø–æ–º–æ—â—å –¥—Ä—É–≥–∏–º</option>
            <option value="power_of_friendship">–°–∏–ª–∞ –¥—Ä—É–∂–±—ã</option>
            <option value="honesty_trust">–ß–µ—Å—Ç–Ω–æ—Å—Ç—å –∏ –¥–æ–≤–µ—Ä–∏–µ</option>
            <option value="accepting_differences">–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–∞–∑–ª–∏—á–∏–π</option>
            <option value="admitting_mistakes">–£–º–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–≤–∞—Ç—å –æ—à–∏–±–∫–∏</option>
            <option value="patience_perseverance">–¢–µ—Ä–ø–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å</option>
            <option value="care_for_nature">–ó–∞–±–æ—Ç–∞ –æ –ø—Ä–∏—Ä–æ–¥–µ</option>
            <option value="safety_caution">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å</option>
            <option value="respect_parents_adults">–£–≤–∞–∂–µ–Ω–∏–µ –∫ —Ä–æ–¥–∏—Ç–µ–ª—è–º –∏ –≤–∑—Ä–æ—Å–ª—ã–º</option>
            <option value="sharing">–£–º–µ–Ω–∏–µ –¥–µ–ª–∏—Ç—å—Å—è</option>
            <option value="independence_responsibility">–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</option>
            <option value="emotions_expression">–≠–º–æ—Ü–∏–∏ –∏ —É–º–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç—å –æ –Ω–∏—Ö</option>
            <option value="anti_bullying">–ü—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è–Ω–∏–µ –±—É–ª–ª–∏–Ω–≥—É</option>
            <option value="value_of_work">–¶–µ–Ω–Ω–æ—Å—Ç—å —Ç—Ä—É–¥–∞</option>
            <option value="tidiness_order">–ê–∫–∫—É—Ä–∞—Ç–Ω–æ—Å—Ç—å –∏ –ø–æ—Ä—è–¥–æ–∫</option>
            <option value="gadgets_moderation">–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –≥–∞–¥–∂–µ—Ç–∞—Ö</option>
            <option value="gratitude">–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å</option>
            <option value="imagination_creativity">–í–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ</option>
          </select>
        </div>

        <!-- –Ø–∑—ã–∫ —Å–∫–∞–∑–∫–∏ -->
        <div class="field">
          <label for="language" id="label_language">–Ø–∑—ã–∫ —Å–∫–∞–∑–∫–∏ *</label>
          <select id="language" name="language" required>
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="en">English</option>
          </select>
        </div>

        <button type="submit" id="submitBtn">–°–æ–∑–¥–∞—Ç—å —Å–∫–∞–∑–∫—É</button>
        <p class="note" id="note">
          –ï—Å–ª–∏ –≤—ã –≤—ã–±—Ä–∞–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç —Å —Ñ–æ—Ç–æ, –±–æ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–æ—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –≤ —á–∞—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã.
        </p>
      </form>
    </div>
  </main>

  <script>
    const tg = window.Telegram?.WebApp || null;
    if (tg) { tg.ready(); tg.expand(); }

    const form = document.getElementById('storyForm');
    const submitBtn = document.getElementById('submitBtn');

    // ====== Language switch (–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫ —É –≤–∞—Å; –Ω–æ–≤—ã–µ –ø–æ–ª—è –Ω–µ –ø–µ—Ä–µ–≤–æ–¥–∏–º, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å –∫–æ–¥) ======
    const translations = {
      ru: {
        title: '–°–æ–∑–¥–∞—Ç—å —Å–∫–∞–∑–∫—É',
        description: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –±–æ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å–∫–∞–∑–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –µ—ë –≤ —á–∞—Ç –≤ –≤–∏–¥–µ PDF-–∫–Ω–∏–≥–∏.',
        submit: '–°–æ–∑–¥–∞—Ç—å —Å–∫–∞–∑–∫—É',
        note: '–ï—Å–ª–∏ –≤—ã –≤—ã–±—Ä–∞–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç —Å —Ñ–æ—Ç–æ, –±–æ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–æ—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –≤ —á–∞—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã.'
      },
      en: {
        title: 'Create a story',
        description: 'Fill in the fields ‚Äî the bot will generate a personalised story and send it to the chat as a PDF book.',
        submit: 'Create story',
        note: 'If you chose the photo option, the bot will ask you to send the photo in chat after the form is submitted.'
      }
    };

    let currentLang = 'ru';
    function applyTranslations(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      document.getElementById('title').textContent = translations[lang].title;
      document.getElementById('description').textContent = translations[lang].description;
      submitBtn.textContent = translations[lang].submit;
      document.getElementById('note').textContent = translations[lang].note;
      if (lang === 'ru' || lang === 'en') form.language.value = lang;
    }

    const langButtons = document.querySelectorAll('.lang-btn');
    langButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const lang = btn.dataset.lang;
        if (lang === currentLang) return;
        langButtons.forEach((b) => b.classList.toggle('lang-btn--active', b === btn));
        applyTranslations(lang);
      });
    });
    applyTranslations('ru');

    // ====== Helpers ======
    function setSelectedCard(groupName, value) {
      const cards = document.querySelectorAll(`.choice-card[data-group="${groupName}"]`);
      cards.forEach(card => {
        const isSelected = card.dataset.value === value;
        card.classList.toggle('choice-card--selected', isSelected);
        const input = card.querySelector('input');
        if (input) input.checked = isSelected;
      });
    }

    function setRequired(el, required) {
      if (!el) return;
      if (required) el.setAttribute('required', '');
      else el.removeAttribute('required');
    }

    function show(el) { el.classList.remove('hidden'); }
    function hide(el) { el.classList.add('hidden'); }

    // ====== Main personalization mode ======
    const mainAppearanceBlock = document.getElementById('mainAppearanceBlock');
    const hintMainPersonalization = document.getElementById('hint_main_personalization');

    function onMainPersonalizationChange(mode) {
      if (mode === 'appearance') {
        show(mainAppearanceBlock);
        hintMainPersonalization.textContent = '–í—ã –≤—ã–±—Ä–∞–ª–∏ ¬´–í–Ω–µ—à–Ω–æ—Å—Ç—å¬ª. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî —ç—Ç–æ –ø–æ–≤—ã—Å–∏—Ç —É–∑–Ω–∞–≤–∞–µ–º–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.';
      } else if (mode === 'photo') {
        hide(mainAppearanceBlock);
        hintMainPersonalization.textContent = '–í—ã –≤—ã–±—Ä–∞–ª–∏ ¬´–§–æ—Ç–æ¬ª. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –±–æ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –≤ —á–∞—Ç–µ.';
      } else {
        hide(mainAppearanceBlock);
        hintMainPersonalization.textContent = '–í—ã –≤—ã–±—Ä–∞–ª–∏ ¬´–ë–µ–∑ –ø–µ—Ä—Å–æ–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏¬ª. –ì–µ—Ä–æ–π –±—É–¥–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º.';
      }

      // required toggles –¥–ª—è –≤–Ω–µ—à–Ω–æ—Å—Ç–∏
      const req = (mode === 'appearance');
      setRequired(document.getElementById('main_gender'), req);
      setRequired(document.getElementById('main_skin_tone'), req);
      setRequired(document.getElementById('main_hair_color'), req);
      setRequired(document.getElementById('main_hair_length'), req);
      setRequired(document.getElementById('main_eye_color'), req);
      setRequired(document.getElementById('main_face_shape'), req);
      setRequired(document.getElementById('main_unique_marks'), req);
      setRequired(document.getElementById('main_outfit'), req);
      setRequired(document.getElementById('main_palette'), req);
    }

    document.querySelectorAll('.choice-card[data-group="main_personalization"]').forEach(card => {
      card.addEventListener('click', () => {
        const mode = card.dataset.value;
        setSelectedCard('main_personalization', mode);
        onMainPersonalizationChange(mode);
      });
    });
    onMainPersonalizationChange('photo'); // default

    // limit multi-select unique marks to 2 (revert if over)
    const uniqueMarksSelect = document.getElementById('main_unique_marks');
    let prevUniqueMarks = [];
    uniqueMarksSelect.addEventListener('change', () => {
      const selected = Array.from(uniqueMarksSelect.selectedOptions).map(o => o.value);
      if (selected.length > 2) {
        // revert
        Array.from(uniqueMarksSelect.options).forEach(opt => opt.selected = prevUniqueMarks.includes(opt.value));
        return;
      }
      prevUniqueMarks = selected;
    });

    // ====== Second character mode ======
    const secondPresetBlock = document.getElementById('secondPresetBlock');
    const secondCustomBlock = document.getElementById('secondCustomBlock');

    function onSecondCharacterChange(mode) {
      if (mode === 'preset') {
        show(secondPresetBlock);
        hide(secondCustomBlock);
      } else if (mode === 'custom') {
        hide(secondPresetBlock);
        show(secondCustomBlock);
      } else {
        hide(secondPresetBlock);
        hide(secondCustomBlock);
      }

      setRequired(document.getElementById('second_character_preset'), mode === 'preset');
      setRequired(document.getElementById('second_custom_name'), mode === 'custom');
      setRequired(document.getElementById('second_custom_type'), mode === 'custom');
      setRequired(document.getElementById('second_custom_traits'), mode === 'custom');
    }

    document.querySelectorAll('.choice-card[data-group="second_character"]').forEach(card => {
      card.addEventListener('click', () => {
        const mode = card.dataset.value;
        setSelectedCard('second_character', mode);
        onSecondCharacterChange(mode);
      });
    });
    onSecondCharacterChange('none'); // default

    // ====== Setting mode ======
    const settingCustomBlock = document.getElementById('settingCustomBlock');

    function onSettingChange(mode) {
      if (mode === 'custom') show(settingCustomBlock);
      else hide(settingCustomBlock);

      setRequired(document.getElementById('setting_type'), mode === 'custom');
      setRequired(document.getElementById('setting_realism'), mode === 'custom');
      setRequired(document.getElementById('setting_details'), mode === 'custom');
    }

    document.querySelectorAll('.choice-card[data-group="setting"]').forEach(card => {
      card.addEventListener('click', () => {
        const mode = card.dataset.value;
        setSelectedCard('setting', mode);
        onSettingChange(mode);
      });
    });
    onSettingChange('forest'); // default

    // ====== Submit ======
    form.addEventListener('submit', function (event) {
      event.preventDefault();
      submitBtn.disabled = true;

      const mainMode = form.querySelector('input[name="main_personalization_mode"]:checked')?.value || 'photo';
      const secondMode = form.querySelector('input[name="second_character_mode"]:checked')?.value || 'none';
      const settingMode = form.querySelector('input[name="setting_mode"]:checked')?.value || 'forest';

      // Collect appearance only if needed
      const mainAppearance = (mainMode === 'appearance') ? {
        gender: form.main_gender.value || null,
        skin_tone: form.main_skin_tone.value || null,
        hair: {
          color: form.main_hair_color.value || null,
          length: form.main_hair_length.value || null,
          type: form.main_hair_type.value || null,
          density: form.main_hair_density.value || null,
          bangs: form.main_hair_bangs.value || null,
          part: form.main_hair_part.value || null,
        },
        eyes: {
          color: form.main_eye_color.value || null,
          shape: form.main_eye_shape.value || null,
          size: form.main_eye_size.value || null
        },
        face: {
          shape: form.main_face_shape.value || null,
          accent: form.main_face_accent.value?.trim() || null
        },
        eyebrows: {
          color: form.main_eyebrows_color.value || null,
          density: form.main_eyebrows_density.value || null,
          shape: form.main_eyebrows_shape.value || null
        },
        nose_size: form.main_nose_size.value || null,
        lips_type: form.main_lips_type.value || null,
        unique_marks: Array.from(form.main_unique_marks.selectedOptions).map(o => o.value),
        unique_marks_other: form.main_unique_marks_other.value?.trim() || null,
        technical_features: form.main_technical_features.value?.trim() || null,
        image_anchor: {
          outfit: form.main_outfit.value?.trim() || null,
          shoes: form.main_shoes.value?.trim() || null,
          accessory: form.main_accessory.value?.trim() || null,
          palette: form.main_palette.value?.trim() || null
        }
      } : null;

      const secondCharacter = (() => {
        if (secondMode === 'preset') {
          return { mode: 'preset', preset: form.second_character_preset.value || null };
        }
        if (secondMode === 'custom') {
          return {
            mode: 'custom',
            name: form.second_custom_name.value?.trim() || null,
            type: form.second_custom_type.value || null,
            appearance: form.second_custom_appearance.value?.trim() || null,
            marks: form.second_custom_marks.value?.trim() || null,
            traits: form.second_custom_traits.value?.trim() || null
          };
        }
        return { mode: 'none' };
      })();

      const setting = (() => {
        if (settingMode === 'custom') {
          return {
            mode: 'custom',
            type: form.setting_type.value || null,
            realism: form.setting_realism.value || null,
            time: form.setting_time.value || null,
            season: form.setting_season.value || null,
            point: form.setting_point.value?.trim() || null,
            details: form.setting_details.value?.trim() || null
          };
        }
        return { mode: 'preset', preset: settingMode };
      })();

      const data = {
        child_name: form.child_name.value.trim(),
        main_personalization_mode: mainMode,
        main_photo_expected: (mainMode === 'photo'),
        main_appearance: mainAppearance,
        second_character: secondCharacter,
        setting,
        age_group: form.age_group.value,
        narrative_style: form.narrative_style.value,
        educational_plot: form.educational_plot.value,
        language: form.language.value,
        ui_language: currentLang
      };

      const tg = window.Telegram?.WebApp || null;
      const isTelegramWebApp = !!(tg && typeof tg.initData === 'string' && tg.initData.length > 0);

      try {
        if (isTelegramWebApp) {
          tg.sendData(JSON.stringify(data));
          setTimeout(() => tg.close(), 250);
        } else {
          alert('–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–Ω–µ Telegram WebApp):\n' + JSON.stringify(data, null, 2));
          submitBtn.disabled = false;
        }
      } catch (e) {
        console.error(e);
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
